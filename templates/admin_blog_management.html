{% extends "Abase.html" %}
{% block content %}
<section style="background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%); min-height:100vh; padding:40px 0;">
    <div class="container" style="color:#bbb;">

        <!-- Header -->
        <div class="row mb-5">
            <div class="col">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-2" style="color:#fff; font-weight:300;">Blog Management</h2>
                        <p class="mb-0" style="color:#888;">Manage all blog posts on your platform</p>
                    </div>
                    <div class="text-end">
                        <div class="text-muted small">Total Blogs: {{ total_blogs }}</div>
                        <div class="text-success small">Platform Status: <span class="badge bg-success">Active</span></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card admin-card h-100" style="background: linear-gradient(135deg, #4b306a 0%, #6a48a0 100%); border:none; border-radius:16px;">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-2" style="color:#fff; font-size:2rem;">{{ total_blogs }}</h3>
                                <p class="mb-0" style="color:#e0d6ff;">Total Blogs</p>
                            </div>
                            <div class="icon-circle" style="background: rgba(255,255,255,0.2);">
                                <i class="fas fa-blog" style="color:#fff; font-size:1.5rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-3 mb-3">
                <div class="card admin-card h-100" style="background: linear-gradient(135deg, #1f6066 0%, #2d8c94 100%); border:none; border-radius:16px;">
                    <div class="card-body p-4">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h3 class="mb-2" style="color:#fff; font-size:2rem;">{{ published_blogs }}</h3>
                                <p class="mb-0" style="color:#d1f7ff;">Published</p>
                            </div>
                            <div class="icon-circle" style="background: rgba(255,255,255,0.2);">
                                <i class="fas fa-eye" style="color:#fff; font-size:1.5rem;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Messages Display -->
        {% if messages %}
        <div class="row mb-4">
            <div class="col">
                {% for message in messages %}
                <div class="alert alert-{{ message.tags }} alert-dismissible fade show" 
                     style="background: {% if message.tags == 'success' %}#155724{% else %}#721c24{% endif %}; 
                            color: {% if message.tags == 'success' %}#d4edda{% else %}#f8d7da{% endif %};
                            border: 1px solid {% if message.tags == 'success' %}#c3e6cb{% else %}#f5c6cb{% endif %};
                            border-radius: 8px;">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"
                            style="filter: invert(1);"></button>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <!-- Blogs Table -->
        <div class="card mb-4" style="background: #1a1a1a; border: 1px solid #333; border-radius: 16px;">
            <div class="card-body p-0">
                {% if blogs %}
                <div class="table-responsive">
                    <table class="table table-hover mb-0" style="background: #1a1a1a; color:#ddd; border:none;">
                        <thead style="background: #2a2a2a; color:#fff;">
                            <tr>
                                <th style="padding:15px; font-weight:500; width: 30px;">
                                    <input type="checkbox" id="selectAll" style="background: #2a2a2a; border: 1px solid #555;">
                                </th>
                                <th style="padding:15px; font-weight:500;">Blog Post</th>
                                <th style="padding:15px; font-weight:500;">Author</th>
                                <th style="padding:15px; font-weight:500;">Stats</th>
                                <th style="padding:15px; font-weight:500;">Status</th>
                                <th style="padding:15px; font-weight:500;">Date</th>
                                <th style="padding:15px; font-weight:500;">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for blog in blogs %}
                            <tr style="border-bottom:1px solid #333; transition: all 0.3s ease;">
                                <td style="padding:15px; vertical-align: middle;">
                                    <input type="checkbox" name="blog_ids" value="{{ blog.id }}" class="blog-checkbox" style="background: #2a2a2a; border: 1px solid #555;">
                                </td>
                                <td style="padding: 15px; vertical-align: middle;">
                                    <div class="d-flex align-items-center">
                                        <div class="blog-icon me-3" style="width:40px; height:40px; background: linear-gradient(135deg, #6c5ce7, #a29bfe); border-radius:10px; display:flex; align-items:center; justify-content:center;">
                                            {% if blog.image %}
                                            <img src="{{ blog.image.url }}" alt="{{ blog.title }}" style="width:100%; height:100%; border-radius:10px; object-fit:cover;">
                                            {% else %}
                                            <i class="fas fa-file-alt" style="color:#fff; font-size:1rem;"></i>
                                            {% endif %}
                                        </div>
                                        <div>
                                            <div style="color:#fff; font-weight:500; font-size:1rem; margin-bottom: 4px;">
                                                {{ blog.title|truncatechars:50 }}
                                            </div>
                                            <small style="color:#aaa; font-size:0.85rem;">
                                                {{ blog.excerpt|default:blog.content|truncatewords:10 }}
                                            </small>
                                        </div>
                                    </div>
                                </td>
                                <td style="padding:15px; vertical-align: middle;">
                                    <div style="color:#fff; font-weight:500; font-size:1rem;">{{ blog.author.fname }}</div>
                                    <small style="color:#aaa; font-size:0.85rem;">{{ blog.author.email }}</small>
                                </td>
                                <td style="padding:15px; vertical-align: middle;">
                                    <div class="blog-stats">
                                        <small style="color:#aaa;">
                                            <i class="fas fa-heart me-1"></i>{{ blog.likes_count }}
                                            <i class="fas fa-comment ms-2 me-1"></i>{{ blog.comments_count }}
                                        </small>
                                    </div>
                                </td>
                                <td style="padding:15px; vertical-align: middle;">
                                    <span class="badge {% if blog.published %}bg-success{% else %}bg-warning text-dark{% endif %}" style="font-size:0.8rem; font-weight:500;">
                                        {{ blog.published|yesno:"Published,Draft" }}
                                    </span>
                                </td>
                                <td style="padding:15px; vertical-align: middle;">
                                    <small style="color:#aaa;">{{ blog.created_at|date:"M d, Y" }}</small>
                                </td>
                                <td style="padding:15px; vertical-align: middle;">
                                    <div class="btn-group" role="group">
                                        <button class="btn btn-sm me-1 view-blog" data-blog-id="{{ blog.id }}"
                                                style="background:#6c5ce7; color:#fff; border-radius:6px; border:none;">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <form method="POST" action="{% url 'admin_deleteblog_action' blog.id 'delete' %}" style="display: inline;">
                                            {% csrf_token %}
                                            <button type="submit" class="btn btn-sm delete-blog"
                                                    style="background:#dc3545; color:#fff; border-radius:6px; border:none;">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </form>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <div class="text-center py-5" style="color:#888;">
                    <i class="fas fa-inbox" style="font-size:3rem; margin-bottom:15px;"></i>
                    <p class="mb-0">No blogs found</p>
                </div>
                {% endif %}
            </div>
        </div>

    </div>
</section>

<!-- Blog View Modal -->
<div class="modal fade" id="blogViewModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="background: #1a1a1a; color: #ddd; border: 1px solid #333;">
            <div class="modal-header" style="border-bottom: 1px solid #333;">
                <h5 class="modal-title" style="color: #fff;">Blog Post</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" style="filter: invert(1);"></button>
            </div>
            <div class="modal-body" id="blogViewContent">
                <!-- Blog content will be loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- Hidden blog content templates -->
<div style="display: none;">
    {% for blog in blogs %}
    <div id="blog-content-{{ blog.id }}">
        <!-- Blog Image -->
        <div class="text-center mb-4">
            {% if blog.image %}
            <img src="{{ blog.image.url }}" alt="{{ blog.title }}" style="max-width: 100%; max-height: 400px; border-radius: 10px; object-fit: cover;">
            {% else %}
            <div class="blog-placeholder" style="width: 100%; height: 200px; background: linear-gradient(135deg, #6c5ce7, #a29bfe); border-radius: 10px; display: flex; align-items: center; justify-content: center;">
                <i class="fas fa-file-alt" style="color: #fff; font-size: 3rem;"></i>
            </div>
            {% endif %}
        </div>

        <!-- Blog Title -->
        <h2 style="color: #fff; text-align: center; margin-bottom: 20px; line-height: 1.3;">{{ blog.title }}</h2>

        <!-- Blog Content -->
        <div class="blog-content" style="margin-bottom: 25px;">
            <div style="color: #ddd; line-height: 1.7; font-size: 1.1rem; white-space: pre-line;">
                {{ blog.content }}
            </div>
        </div>

        <!-- Posted By -->
        <div style="border-top: 1px solid #333; padding-top: 15px;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
                <div>
                    <small style="color: #aaa;">Posted by: <span style="color: #fff; font-weight: 500;">{{ blog.author.fname }}</span></small>
                </div>
                <div>
                    <small style="color: #aaa;">{{ blog.created_at|date:"F d, Y" }}</small>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}
</div>

<style>
.admin-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
}

.icon-circle {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
}

.table-hover tbody tr:hover {
    background: #2a2a2a !important;
    transform: translateY(-1px);
}

.blog-icon {
    transition: transform 0.3s ease;
}

tr:hover .blog-icon {
    transform: scale(1.1);
}

.btn-group .btn:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(0,0,0,0.2);
}

/* Blog content scroll styling */
.blog-content {
    max-height: 500px;
    overflow-y: auto;
    padding-right: 10px;
}

.blog-content::-webkit-scrollbar {
    width: 6px;
}

.blog-content::-webkit-scrollbar-track {
    background: #2a2a2a;
    border-radius: 3px;
}

.blog-content::-webkit-scrollbar-thumb {
    background: #6c5ce7;
    border-radius: 3px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectAll = document.getElementById('selectAll');
    const blogCheckboxes = document.querySelectorAll('.blog-checkbox');
    
    if (selectAll) {
        selectAll.addEventListener('change', function() {
            blogCheckboxes.forEach(checkbox => {
                checkbox.checked = this.checked;
            });
        });
    }
    const viewButtons = document.querySelectorAll('.view-blog');
    viewButtons.forEach(btn => {
        btn.addEventListener('click', function() {
            const blogId = this.getAttribute('data-blog-id');
            showBlogContent(blogId);
        });
    });

    function showBlogContent(blogId) {
        const modalContent = document.getElementById('blogViewContent');
        
        const templateId = 'blog-content-' + blogId;
        const template = document.getElementById(templateId);
        
        if (template) {
            modalContent.innerHTML = template.innerHTML;
        } else {
            modalContent.innerHTML = `
                <div class="text-center text-danger py-4">
                    <i class="fas fa-exclamation-triangle fa-2x mb-3"></i>
                    <p>Blog content not found.</p>
                </div>
            `;
        }

        const modal = new bootstrap.Modal(document.getElementById('blogViewModal'));
        modal.show();
    }
});

function confirmDelete(blogTitle) {
    return confirm(`Are you sure you want to delete the blog "${blogTitle}"? This action cannot be undone.`);
}
</script>
{% endblock %}